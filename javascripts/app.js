!function(){"use strict";var e="undefined"!=typeof window?window:global;if("function"!=typeof e.require){var t={},n={},i=function(e,t){return{}.hasOwnProperty.call(e,t)},r=function(e,t){var n,i,r=[];n=/^\.\.?(\/|$)/.test(t)?[e,t].join("/").split("/"):t.split("/");for(var s=0,o=n.length;o>s;s++)i=n[s],".."===i?r.pop():"."!==i&&""!==i&&r.push(i);return r.join("/")},s=function(e){return e.split("/").slice(0,-1).join("/")},o=function(t){return function(n){var i=s(t),o=r(i,n);return e.require(o,t)}},a=function(e,t){var i={id:e,exports:{}};return n[e]=i,t(i.exports,o(e),i),i.exports},c=function(e,s){var o=r(e,".");if(null==s&&(s="/"),i(n,o))return n[o].exports;if(i(t,o))return a(o,t[o]);var c=r(o,"./index");if(i(n,c))return n[c].exports;if(i(t,c))return a(c,t[c]);throw new Error('Cannot find module "'+e+'" from "'+s+'"')},h=function(e,n){if("object"==typeof e)for(var r in e)i(e,r)&&(t[r]=e[r]);else t[e]=n},l=function(){var e=[];for(var n in t)i(t,n)&&e.push(n);return e};e.require=c,e.require.define=h,e.require.register=h,e.require.list=l,e.require.brunch=!0}}(),require.register("app",function(e,t){var n=t("scripts/controllers/layout"),i=new Backbone.Marionette.Region({el:"#main"}),r=new n({region:i});r.show()}),require.register("bus",function(e,t,n){var i=new Backbone.Wreqr.EventAggregator,r=new Backbone.Wreqr.RequestResponse;n.exports={Event:i,Reqres:r}}),require.register("config",function(e,t,n){var i=t("scripts/collections/notes"),r=["A","A#","B","C","C#","D","D#","E","F","F#","G","G#"],s={};_.each(r,function(e){s[e]=new i(e)}),n.exports={notes:r,chromaticScales:s,modes:{Ionian:[0,2,4,5,7,9,11],Dorian:[0,2,3,5,7,9,10],Phrygian:[0,1,3,5,7,8,10],Lydian:[0,2,4,6,7,9,11],Mixolydian:[0,2,4,5,7,9,10],Aeolian:[0,2,3,5,7,8,10],Locrian:[0,1,3,5,6,8,10],"Iwato Scale":[0,1,10,5,6],"Major Pentatonic Scale":[0,9,2,4,7]},instruments:{Bass:{type:"fretted-string",frets:20,strings:["G","D","A","E"],lengthPerFret:60,stringHeight:40,padding:40,nutWidth:15,fretWidth:6},Guitar:{type:"fretted-string",frets:22,strings:["E","B","G","D","A","E"],lengthPerFret:50,stringHeight:25,padding:30,nutWidth:15,fretWidth:4}}}}),require.register("defaults",function(e,t,n){n.exports={tonic:"C",mode:"Ionian",instrument:"Bass"}}),require.register("scripts/collections/fretted-strings",function(e,t,n){var i=t("../models/fretted-string"),r=t("defaults"),s=t("config"),o=Backbone.Collection.extend({model:i,url:"/fretted-strings",settings:null,fretDistanceMap:null,displayWidth:0,displayHeight:0,initialize:function(e,t){this.options=t||{},this.settings=t.settings,this._setSettings(),_.each(this.settings.strings,function(e){this.create({tonic:e,frets:this.settings.frets})},this)},getFrets:function(){return this.options.frets},getDisplayHeight:function(){return this.settings.displayHeight},getDisplayWidth:function(){return this.settings.displayWidth},_setSettings:function(){for(var e=this.settings.strings,t=this.settings.frets,n=this.settings.lengthPerFret*t,i=0,r={},s=1;t>=s;s++){var o=n-i,a=o/17.817;i+=a,r[s]={distance:i,width:a}}var c=2*this.settings.padding,h=i+c;this.settings.displayWidth=h,this.settings.fretDistanceMap=r,this.settings.displayHeight=e.length*this.settings.stringHeight+c},sync:function(){}}),a=s.instruments[r.instrument];n.exports=function(e){return e=e||a,new o(null,{settings:e})}}),require.register("scripts/collections/notes",function(e,t,n){var i=t("../models/note"),r=t("defaults"),s=[{name:"C",color:"#ff0000"},{name:"C#",color:"#ff6600"},{name:"D",color:"#ff9400"},{name:"D#",color:"#ffc500"},{name:"E",color:"#ffff00"},{name:"F",color:"#8cc700"},{name:"F#",color:"#0fad00"},{name:"G",color:"#00a3c7"},{name:"G#",color:"#0064b5"},{name:"A",color:"#0010a5"},{name:"A#",color:"#6300a5"},{name:"B",color:"#c5007c"}],o=Backbone.Collection.extend({model:i,url:"/notes",noteCache:null,initialize:function(e,t){this.options=t||{},this.noteCache=[];var n=this.options.tonic,i=this._getNotesFrom(n);_.each(i,function(e){this.create(e),this.noteCache.push(e.name)},this)},getTonic:function(){return this.first().get("name")},getNotes:function(){return this.noteCache.join(" ")},getNotesArray:function(){return this.noteCache},_getNotesFrom:function(e){var t,n=[];_.each(s,function(i,r){i.name===e&&(t=r),n.push({name:i.name,color:i.color})});var i=n.splice(t,n.length-t);return i=i.concat(n)},sync:function(){}});n.exports=function(e){var e=e||r.tonic;return new o(null,{tonic:e})}}),require.register("scripts/controllers/color-wheel",function(e,t,n){var i=t("scripts/views/color-wheel"),r=t("../views/constellation"),s=t("config"),o=t("defaults"),a=t("bus");n.exports=Backbone.Marionette.Controller.extend({baseLayer:null,mouseoverLayer:null,constellationLayer:null,stage:null,wheel:null,constellation:null,_currentMode:o.mode,_currentTonic:o.tonic,initialize:function(e){this.options=e||{},this.stage=new Konva.Stage({container:this.options.container,width:500,height:500}),this.baseLayer=new Konva.Layer,this.mouseoverLayer=new Konva.Layer,this.constellationLayer=new Konva.Layer,this.stage.add(this.baseLayer,this.mouseoverLayer,this.constellationLayer),a.Event.on("change:tonic",this._changeTonic,this),a.Event.on("change:mode",this._changeMode,this),a.Reqres.setHandler("current:tonic",function(){return this._currentTonic},this),a.Reqres.setHandler("current:mode",function(){return this._currentMode},this)},_changeMode:function(e){this._currentMode=e,this._clearPreviousConstellation();var t=s.modes[e];this.constellation=new r({stage:this.stage,baseLayer:this.constellationLayer,collection:t})},_clearPreviousConstellation:function(){_.isNull(this.constellation)||(this.constellation.off(),this.constellation.destroy(),this.constellationLayer.destroyChildren(),this.stage.draw())},_changeTonic:function(e){this._currentTonic=e,this._clearPreviousWheel(),this._showColorWheel(e)},_clearPreviousWheel:function(){_.isNull(this.wheel)||(this.wheel.off(),this.wheel.destroy(),this.baseLayer.destroyChildren(),this.mouseoverLayer.destroyChildren(),this.stage.draw())},_showColorWheel:function(e){this.wheel=new i({stage:this.stage,baseLayer:this.baseLayer,mouseoverLayer:this.mouseoverLayer,collection:s.chromaticScales[e]})}})}),require.register("scripts/controllers/fretted-string",function(e,t,n){var i=t("../views/instruments/fretted"),r=t("scripts/collections/fretted-strings"),s=t("config"),o=t("bus");n.exports=Backbone.Marionette.Controller.extend({baseLayer:null,mouseoverLayer:null,stage:null,frettedString:null,initialize:function(e){this.options=e||{},o.Event.on("change:instrument",this._changeInstrument,this)},_showInstrument:function(e){var t=s.instruments[e],n=new r(t),o={height:n.getDisplayHeight(),width:n.getDisplayWidth()};this._initializeStageAndLayers(o),this.frettedString=new i({collection:n,stage:this.stage,baseLayer:this.baseLayer,mouseoverLayer:this.mouseoverLayer})},_initializeStageAndLayers:function(e){this.stage=new Konva.Stage({container:this.options.container,width:e.width,height:e.height}),this.baseLayer=new Konva.Layer,this.mouseoverLayer=new Konva.Layer,this.stage.add(this.baseLayer,this.mouseoverLayer)},_changeInstrument:function(e){this._clearPreviousInstrument(),this._showInstrument(e)},_clearPreviousInstrument:function(){_.isNull(this.frettedString)||(this.frettedString.off(),this.frettedString.destroy(),this.baseLayer.destroyChildren(),this.mouseoverLayer.destroyChildren(),this.baseLayer.destroy(),this.mouseoverLayer.destroy(),this.stage.destroy(),this.stage=null)}})}),require.register("scripts/controllers/layout",function(e,t,n){{var i=t("../views/layout"),r=t("../views/selector"),s=t("./color-wheel"),o=t("./fretted-string");t("config"),t("bus")}n.exports=Backbone.Marionette.Controller.extend({initialize:function(e){this.options=e||{}},show:function(){var e=new i;this.options.region.show(e);{var t=new r,n=$(e.getRegion("colorWheel").el)[0],a=(new s({container:n}),$(e.getRegion("instrument").el)[0]);new o({container:a})}e.getRegion("selector").show(t)}})}),require.register("scripts/models/fretted-string",function(e,t,n){var i=t("config"),r=t("defaults");n.exports=Backbone.Model.extend({_notes:null,defaults:{tonic:r.tonic,frets:i.instruments[r.instrument].frets},initialize:function(){var e=i.chromaticScales[this.get("tonic")],t=[],n=e.length,r=this.get("frets")+1;_(r).range().map(function(i){var r=i>=n?i%n:i;t.push(e.at(r))}),this._notes=t,this.set("notes",t),this.set("noteNames",_.map(t,function(e){return e.get("name")}))},sync:function(){}})}),require.register("scripts/models/note",function(e,t,n){n.exports=Backbone.Model.extend({defaults:{name:void 0,color:void 0},sync:function(){}})}),require.register("scripts/views/color-wheel",function(e,t,n){var i=30,r=-90-i/2,s=t("./konva"),o=t("bus");n.exports=s.extend({wedgeGroup:null,labelGroup:null,currentTween:null,events:{"mouseover .note-wedge":"_scaleUpWedge","mouseout .note-wedge":"_resetWedge","click .note-wedge":"_changeTonic"},initialize:function(e){e=e||{},this.baseLayer=e.baseLayer,this.mouseoverLayer=e.mouseoverLayer,this.stage=e.stage,this.options=e,this.render()},_changeTonic:function(e){var t=e.target,n=t.getAttr("id").split("-")[1];o.Event.trigger("change:tonic",n)},_scaleUpWedge:function(e){var t=e.target;o.Event.trigger("note:highlighted",t.getAttr("id")),t.moveTo(this.mouseoverLayer);var n=1.15,r=i*n,s=t.getAttr("startRotation")-i*n/2+i/2;this.currentTween=new Konva.Tween({node:t,duration:.5,easing:Konva.Easings.ElasticEaseOut,scaleX:n,scaleY:n,angle:r,rotation:s}),this.currentTween.play(),this.stage.draw()},_addToGroup:function(){this.wedgeGroup=new Konva.Group,this.labelGroup=new Konva.Group,this.collection.each(function(e,t){this._addWedge(e,t),this._addLabel(e,t)},this),this.group.add(this.wedgeGroup),this.group.add(this.labelGroup)},_addLabel:function(e,t){var n=-90,r=n+i*t,s=this.getPositionFromAngle(250,250,r,200),o=new Konva.Text({x:s.x,y:s.y,text:e.get("name"),id:"label-"+e.get("name"),fontSize:24,fill:"black"});o.setOffset({x:o.getWidth()/2,y:o.getHeight()/2}),this.labelGroup.add(o)},_addWedge:function(e,t){var n=r+i*t,s=new Konva.Wedge({x:250,y:250,radius:150,angle:i,name:"note-wedge",id:"note-"+e.get("name"),fill:e.get("color"),rotation:n,startRotation:n,scale:{x:1,y:1},startScale:1});this.wedgeGroup.add(s)},_resetWedge:function(e){var t=e.target;o.Event.trigger("note:unhighlighted",t.getAttr("id")),t.moveTo(this.baseLayer),this.currentTween&&this.currentTween.pause(),t.setAttrs({scaleY:1,scaleX:1,angle:i,rotation:t.getAttr("startRotation")}),this.stage.draw()},onDestroy:function(){this.wedgeGroup.destroyChildren(),this.labelGroup.destroyChildren()}})}),require.register("scripts/views/constellation",function(e,t,n){var i=30,r=-90,s=t("./konva");n.exports=s.extend({labelGroup:null,linesGroup:null,initialize:function(e){e=e||{},this.baseLayer=e.baseLayer,this.stage=e.stage,this.options=e,this.render()},_addToGroup:function(){this.labelGroup=new Konva.Group,this.linesGroup=new Konva.Group;var e=[],t=[];_.each(this.collection,function(n){var s=r+i*n,o=this.getPositionFromAngle(250,250,s,150);e.push(o);var a=this.getPositionFromAngle(250,250,s,162);t.push(a)},this),this._addLines(e),this._addLabels(t),this.group.add(this.linesGroup),this.group.add(this.labelGroup)},_addLabels:function(e){_.each(e,function(e,t){var n=new Konva.Text({x:e.x,y:e.y,text:t+1,id:"number-label-"+(t+1),fontSize:16,fill:"white",shadowColor:"black",shadowBlur:4});n.setOffset({x:n.getWidth()/2,y:n.getHeight()/2}),this.labelGroup.add(n)},this)},_addLines:function(e){var e=_.map(this.collection,function(e){var t=r+i*e,n=this.getPositionFromAngle(250,250,t,150);return n},this),t=_.rest(e);_.each(t,function(e){var t=this._getLineAttributes(e),n=new Konva.Line(t);n.setListening(!1),this.group.add(n)},this);var n=_.first(e),s=this._getLineAttributes(n);s=_.extend(s,{pointerLength:12,pointerWidth:8,radius:10});var o=new Konva.Arrow(s);o.setListening(!1),this.linesGroup.add(o)},_getLineAttributes:function(e){return{points:[250,250,e.x,e.y],fill:"white",stroke:"white",strokeWidth:2,shadowColor:"black",shadowBlur:3,shadowOffset:{x:0,y:0}}},onDestroy:function(){this.linesGroup.destroyChildren(),this.labelGroup.destroyChildren(),this.linesGroup.destroy(),this.labelGroup.destroy()}})}),require.register("scripts/views/instruments/fretted",function(e,t,n){var i=t("../konva"),r=t("bus"),s=(t("defaults"),t("config"));n.exports=i.extend({currentTweens:null,events:{},initialize:function(e){e=e||{},this.baseLayer=e.baseLayer,this.mouseoverLayer=e.mouseoverLayer,this.stage=e.stage,this.options=e,this.currentTweens=[],this.render(),r.Event.on("note:highlighted",function(e){var t=this.noteGroup.find("."+e);_.each(this.currentTweens,function(e){e.destroy()});var n=this.mouseoverLayer;t.each(function(e){e.moveTo(n);var t=e.getAttr("color");e.setAttrs({shadowBlur:10,shadowEnabled:!0,shadowColor:t,opacity:1})}),this.stage.draw()},this),r.Event.on("note:unhighlighted",function(e){var t=this.mouseoverLayer.find("."+e);_.each(this.currentTweens,function(e){e.destroy()});var n=this.noteGroup;t.each(function(e){e.moveTo(n);var t=e.getAttr("initialOpacity");e.setAttrs({opacity:t,shadowEnabled:!1})}),this.stage.draw()},this),r.Event.on("change:mode",function(e){this.noteGroup.children.each(function(e){e.setAttrs({opacity:.1,initialOpacity:.1})});var t=s.modes[e],n=r.Reqres.request("current:tonic"),i=s.chromaticScales[n],o=_.map(t,function(e){return".note-"+i.at(e).get("name")}).join(","),a=this.noteGroup.find(o);a.each(function(e){e.setAttrs({opacity:1,initialOpacity:1})}),this.stage.draw()},this)},_addNut:function(e,t,n){var i=_.first(e.get("notes")),r="note-"+i.get("name"),s=new Konva.Rect({x:0,y:n.stringHeight*t+n.padding,width:n.padding-n.nutWidth,height:n.stringHeight,fill:i.get("color"),name:r,opacity:.1});this.noteGroup.add(s);var o=new Konva.Rect({x:n.padding-n.nutWidth,y:n.stringHeight*t+n.padding,width:n.nutWidth,height:n.stringHeight,fill:"black"});this.fretGroup.add(o)},_addNotes:function(e,t,n){for(var i=1;i<=e.get("frets");i++){var r=this.collection.settings.fretDistanceMap[i],s=new Konva.Rect({x:n.padding+r.distance-n.fretWidth,y:n.stringHeight*t+n.padding,width:n.fretWidth,height:n.stringHeight,fill:"silver"});this.fretGroup.add(s);var o=new Konva.Rect({x:n.padding+r.distance-r.width,y:n.stringHeight*t+n.padding,width:r.width-n.fretWidth,height:n.stringHeight,fill:e.get("notes")[i].get("color"),name:"note-"+e.get("notes")[i].get("name"),opacity:.1});this.noteGroup.add(o)}},_addStrings:function(e,t,n){var i=new Konva.Rect({x:0,y:n.stringHeight/2-n.fretWidth/2+n.stringHeight*t+n.padding,width:n.padding,height:n.fretWidth,fill:e.get("notes")[0].get("color"),name:"note-"+e.get("notes")[0].get("name")});this.stringGroup.add(i);var e=new Konva.Rect({x:n.padding,y:n.stringHeight/2-n.fretWidth/2+n.stringHeight*t+n.padding,width:this.collection.settings.displayWidth,height:n.fretWidth,fill:"black"});this.stringGroup.add(e)},_addToGroup:function(){this.fretGroup=new Konva.Group,this.noteGroup=new Konva.Group,this.stringGroup=new Konva.Group;var e=this.collection.settings;this.collection.each(function(t,n){this._addNut(t,n,e),this._addNotes(t,n,e),this._addStrings(t,n,e)},this),this.group.add(this.fretGroup),this.group.add(this.noteGroup),this.group.add(this.stringGroup)},onDestroy:function(){this.fretGroup.destroyChildren(),this.noteGroup.destroyChildren(),this.stringGroup.destroyChildren()}})}),require.register("scripts/views/konva",function(e,t,n){n.exports=Backbone.KonvaView.extend({group:null,baseLayer:null,el:function(){return this.group=new Konva.Group,this._addToGroup(),this.group},render:function(){this.baseLayer.add(this.el),this.stage.draw()},destroy:function(){this.undelegateEvents(),this.onDestroy(),this.group.destroyChildren(),this.group.destroy()},onDestroy:function(){},getPositionFromAngle:function(e,t,n,i){var r=n*(Math.PI/180);return{x:e+i*Math.cos(r),y:t+i*Math.sin(r)}},_addToGroup:function(){}})}),require.register("scripts/views/layout",function(e,t,n){var i=t("./templates/layout");n.exports=Backbone.Marionette.LayoutView.extend({tagName:"div",className:"layout",template:i,regions:{colorWheel:"#color-wheel-container",instrument:"#instrument-container",selector:"#selector"}})}),require.register("scripts/views/selector",function(e,t,n){var i=t("./templates/item-selector"),r=t("config"),s=t("defaults"),o=t("bus");n.exports=Backbone.Marionette.ItemView.extend({tagName:"div",className:"selector-container",template:i,ui:{tonicSelect:"select.tonic",modeSelect:"select.mode",instrumentSelect:"select.instrument"},events:{"change @ui.tonicSelect":"changeTonic","change @ui.modeSelect":"changeMode","change @ui.instrumentSelect":"changeInstrument"},initialize:function(){o.Event.on("change:tonic",this._updateTonic,this)},changeInstrument:function(e){var t=$(e.currentTarget).val();o.Event.trigger("change:instrument",t)},changeMode:function(e){var t=$(e.currentTarget).val();o.Event.trigger("change:mode",t)},changeTonic:function(e){var t=$(e.currentTarget).val();o.Event.trigger("change:tonic",t)},onRender:function(){o.Event.trigger("change:instrument",s.instrument),o.Event.trigger("change:mode",s.mode),o.Event.trigger("change:tonic",s.tonic)},serializeData:function(){return{notes:r.notes,modes:_.keys(r.modes),instruments:_.keys(r.instruments)}},_updateTonic:function(e){this.ui.tonicSelect.val(e)},_updateMode:function(e){this.ui.modeSelect.val(e)},onDestroy:function(){o.Event.off("change:tonic",this._updateTonic,this),o.Event.off("change:mode",this._updateMode,this)}})}),require.register("scripts/views/templates/item-selector",function(e,t,n){var i=Handlebars.template({1:function(e){var t=this.lambda,n=this.escapeExpression;return'<option value="'+n(t(e,e))+'">'+n(t(e,e))+"</option>\r\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r,s='<select class="tonic">\r\n';return r=t.each.call(e,null!=e?e.notes:e,{name:"each",hash:{},fn:this.program(1,i),inverse:this.noop,data:i}),null!=r&&(s+=r),s+='</select>\r\n\r\n<select class="mode">\r\n',r=t.each.call(e,null!=e?e.modes:e,{name:"each",hash:{},fn:this.program(1,i),inverse:this.noop,data:i}),null!=r&&(s+=r),s+='</select>\r\n\r\n<select class="instrument">\r\n',r=t.each.call(e,null!=e?e.instruments:e,{name:"each",hash:{},fn:this.program(1,i),inverse:this.noop,data:i}),null!=r&&(s+=r),s+"</select>\n"},useData:!0});"function"==typeof define&&define.amd?define([],function(){return i}):"object"==typeof n&&n&&n.exports&&(n.exports=i)}),require.register("scripts/views/templates/layout",function(e,t,n){var i=Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<div id="selector"></div>\r\n<div id="color-wheel-container"></div>\r\n<div id="instrument-container"></div>\n'},useData:!0});"function"==typeof define&&define.amd?define([],function(){return i}):"object"==typeof n&&n&&n.exports&&(n.exports=i)});